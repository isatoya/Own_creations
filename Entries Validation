
Option Explicit
'variables para todo el proyecto

Dim wbauditoria, archivoBase As Workbook
Dim hojaBase, hojaOrigen As Worksheet
Dim Fecha1, Fecha2, Fecha3, mes, Mes_Texto, BPA, año, dia, auditoria, ruta, Ruta_pais, Ruta_Año, Ruta_Audi, ruta_Base, texto, ExisteArchivo As String
Dim hoja As Integer
Dim lastRow, lastCol, i As Long
Dim titulos As Variant
Dim rng As Range

Sub Ejecutar_Audit()

' Verificar si hay datos en las celdas I8 y M8
If ThisWorkbook.Sheets("Home Page").Range("I8").Value = "" Or ThisWorkbook.Sheets("Home Page").Range("E18").Value = "" Then
    MsgCase "Incomplete data, please enter the data before executing.", vbExclamation
    Exit Sub
End If

' Llama a cada una de las funciones
InicializarVariables
CrearCarpetas
Desarrollo_Entries_Validation

End Sub

Sub InicializarVariables()
'Definicion de las variables
    
'Fechas
mes = ThisWorkbook.Sheets("Home Page").Range("N8").Text
Mes_Texto = ThisWorkbook.Sheets("Home Page").Range("I12").Value
año = ThisWorkbook.Sheets("Home Page").Range("I10").Value
Fecha1 = ThisWorkbook.Sheets("Home Page").Range("I8").Value
Fecha2 = ThisWorkbook.Sheets("Home Page").Range("M8").Value
dia = ThisWorkbook.Sheets("Home Page").Range("N10").Text
BPA = ThisWorkbook.Sheets("Home Page").Range("E18").Text
auditoria = ThisWorkbook.Sheets("Home Page").Range("M17").Text

'Rutas
ruta = ThisWorkbook.Path & "\"
Ruta_pais = ruta & "YE"
Ruta_Audi = Ruta_pais & "\" & "Audit"
Ruta_Año = Ruta_Audi & "\" & año

End Sub
Sub CrearCarpetas()

'PAIS
Ruta_pais = ruta & "YE"
If Dir(Ruta_pais, vbDirectory + vbHidden) = "" Then
    If Dir(Ruta_pais & vbDirectory + vbHidden) = "" Then MkDir Ruta_pais
End If

'CARPETA DE AUDITORIAS
Ruta_Audi = Ruta_pais & "\" & "Audit"
If Dir(Ruta_Audi, vbDirectory + vbHidden) = "" Then
    If Dir(Ruta_Audi & vbDirectory + vbHidden) = "" Then MkDir Ruta_Audi
End If

'CARPETA AÑO
Ruta_Año = Ruta_Audi & "\" & año
If Dir(Ruta_Año, vbDirectory + vbHidden) = "" Then
    If Dir(Ruta_Audi & vbDirectory + vbHidden) = "" Then MkDir Ruta_Año
End If
     
End Sub

Sub Desarrollo_Entries_Validation()

'Crear un nuevo libro de Excel y le pone el nombre correspondiente a la auditoria
Set wbauditoria = Workbooks.Add
wbauditoria.SaveAs Ruta_Año & "\" & año & mes & " " & auditoria & ".xlsx"

'Crea las hojas
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "CaseJ entry"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Base X before"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT X Before"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT X Before-values"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Base X After"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT X After"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT X After-values"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Base Z before"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT Z Before"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT Z Before-values"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Base Z After"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT Z After"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "PT Z After-values"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Validation Z"
wbauditoria.Sheets.Add(After:=wbauditoria.Sheets(wbauditoria.Sheets.Count)).Name = "Validation X"
Application.DisplayAlerts = False
Sheets(1).Delete
Application.DisplayAlerts = True


'---------------------------------- ABRE ARCHIVO DE X (BEFORE) ----------------------------------
MsgCase "Please select the X (BEFORE) database file downloaded from SAP", vbInformation
ruta_Base = Application.GetOpenFilename("Archivos Excel (*.xls; *.xlsx), *.xls; *.xlsx")
Application.AskToUpdateLinks = False

' Verifica si el usuario seleccionó un archivo
If ruta_Base <> "Falso" Then
    'Abre el archivo base
    Set archivoBase = Workbooks.Open(Filename:=ruta_Base, UpdateLinks:=0)
    archivoBase.Activate
    Set hojaOrigen = archivoBase.Sheets(1)
    
    'Filtra solo los TTA
    Sheets(1).Activate
    lastRow = Cells(Rows.Count, "A").End(xlUp).row
    Rows("1:1").AutoFilter
    Rows("1:1").AutoFilter Field:=14, Criteria1:="=###"
    Range("A1:P" & lastRow).SpecialCells(xlCellTypeVisible).Copy
    wbauditoria.Sheets("Base X before").Cells(1, 1).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    
    'Guarda el archivo nuevo y cierra el de la base
    wbauditoria.Save
    archivoBase.Close SaveChanges:=False
    
Else
End If

'Poner todos los boxes para que el rango no cambie
lastRow = Sheets("Base X before").Cells(Sheets("Base X before").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("Base X before").Cells(2, Sheets("Base X before").Columns.Count).End(xlToLeft).Column

ThisWorkbook.Sheets("Anexxes").Range("H2:H25").Copy
wbauditoria.Sheets("Base X before").Cells(lastRow + 1, "L").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
ThisWorkbook.Sheets("Anexxes").Range("I2:I25").Copy
wbauditoria.Sheets("Base X before").Cells(lastRow + 1, "A").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False


'Crea tabla dinamica
Sheets("Base X before").Activate

    Dim ult_Tabla As Long
    ult_Tabla = Cells(Rows.Count, "A").End(xlUp).row
    Dim rangoTabla1 As Range
    Set rangoTabla1 = Sheets("Base X before").Range("A1:P" & ult_Tabla)
    ActiveSheet.ListObjects.Add(xlSrcRange, rangoTabla1, , xlYes).Name = "Tabla1"
    
    'Crear tabla dinamica
    Dim celdaTablaDinamica1 As Range
    Set celdaTablaDinamica1 = Sheets("PT X Before").Range("A1")
    Dim tablaDinamica1 As PivotTable
    
    'Activa campos y le pone formato tabular
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        rangoTabla1, Version:=6).CreatePivotTable TableDestination:= _
        celdaTablaDinamica1, TableName:="tablaDinamica1", DefaultVersion:=6
        
    Sheets("PT X Before").Select
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR")
        .Orientation = xlRowField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN")
        .Orientation = xlRowField
        .Position = 3
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA")
        .Orientation = xlRowField
        .Position = 4
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR")
        .Orientation = xlRowField
        .Position = 5
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART")
        .Orientation = xlColumnField
        .Position = 1
    End With
    ActiveSheet.PivotTables("tablaDinamica1").AddDataField ActiveSheet.PivotTables( _
        "tablaDinamica1").PivotFields("BETRG"), "Cuenta de BETRG", xlCount
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Cuenta de BETRG")
        .Caption = "Suma de BETRG"
        .Function = xlSum
    End With
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERSONID").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("FORML").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("INDX1").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KOSTL").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("STEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LGART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BETRG").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").RowAxisLayout xlTabularRow
    ActiveSheet.PivotTables("tablaDinamica1").RepeatAllLabels xlRepeatLabels
    
    
wbauditoria.Save

'Copia y pega los datos en la hoja de valores
lastRow = Sheets("PT X Before").Cells(Sheets("PT X Before").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("PT X Before").Cells(2, Sheets("PT X Before").Columns.Count).End(xlToLeft).Column
Sheets("PT X Before").Range(Cells(2, 1), Cells(lastRow - 1, lastCol)).Copy
Sheets("PT X Before-values").Range("B1").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False

'Texto a numero
Sheets("PT X Before-values").Activate
lastRow = Cells(Rows.Count, "B").End(xlUp).row
For i = 2 To lastRow
    If IsNumeric(Range("b" & i).Value) Then
        Range("B" & i).Value = Val(Range("B" & i).Value)
    End If
Next i

'Formula del concatenar el KEY NUMBER
Range("A1").Value = "KEY NUMBER"
lastRow = Cells(Rows.Count, "B").End(xlUp).row
Sheets("PT X Before-values").Range("A2:A" & lastRow) = "=+CONCATENATE(RC[1],RC[2])"
Columns("A:AB").AutoFit

'Elimina los numeros de empleado que son 00000000
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "0" Then
            Rows(i).Delete
        End If
Next i


lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "999999" Then
            Rows(i).Delete
        End If
Next i

wbauditoria.Save


'---------------------------------- ABRE ARCHIVO DE X (AFTER) ----------------------------------
MsgCase "Please select the X (AFTER) database file downloaded from SAP", vbInformation
ruta_Base = Application.GetOpenFilename("Archivos Excel (*.xls; *.xlsx), *.xls; *.xlsx")
Application.AskToUpdateLinks = False

' Verifica si el usuario seleccionó un archivo
If ruta_Base <> "Falso" Then
    'Abre el archivo base
    Set archivoBase = Workbooks.Open(Filename:=ruta_Base, UpdateLinks:=0)
    archivoBase.Activate
    Set hojaOrigen = archivoBase.Sheets(1)
    
    'Filtra solo los TTA
    Sheets(1).Activate
    lastRow = Cells(Rows.Count, "A").End(xlUp).row
    Rows("1:1").AutoFilter
    Rows("1:1").AutoFilter Field:=14, Criteria1:="=###"
    Range("A1:P" & lastRow).SpecialCells(xlCellTypeVisible).Copy
    wbauditoria.Sheets("Base X After").Cells(1, 1).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    
    'Guarda el archivo nuevo y cierra el de la base
    wbauditoria.Save
    archivoBase.Close SaveChanges:=False
    
Else
End If

'Poner todos los boxes para que el rango no cambie
lastRow = Sheets("Base X After").Cells(Sheets("Base X After").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("Base X After").Cells(2, Sheets("Base X After").Columns.Count).End(xlToLeft).Column

ThisWorkbook.Sheets("Anexxes").Range("H2:H25").Copy
wbauditoria.Sheets("Base X After").Cells(lastRow + 1, "L").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
ThisWorkbook.Sheets("Anexxes").Range("I2:I25").Copy
wbauditoria.Sheets("Base X After").Cells(lastRow + 1, "A").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False

'Crea tabla dinamica
Sheets("Base X After").Activate

    ult_Tabla = Cells(Rows.Count, "A").End(xlUp).row
    Set rangoTabla1 = Sheets("Base X After").Range("A1:P" & ult_Tabla)
    ActiveSheet.ListObjects.Add(xlSrcRange, rangoTabla1, , xlYes).Name = "Tabla1"
    
    'Crear tabla dinamica
    Set celdaTablaDinamica1 = Sheets("PT X After").Range("A1")
    
    'Activa campos y le pone formato tabular
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        rangoTabla1, Version:=6).CreatePivotTable TableDestination:= _
        celdaTablaDinamica1, TableName:="tablaDinamica1", DefaultVersion:=6
        
    Sheets("PT X After").Select
        With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR")
        .Orientation = xlRowField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN")
        .Orientation = xlRowField
        .Position = 3
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA")
        .Orientation = xlRowField
        .Position = 4
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR")
        .Orientation = xlRowField
        .Position = 5
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART")
        .Orientation = xlColumnField
        .Position = 1
    End With
    ActiveSheet.PivotTables("tablaDinamica1").AddDataField ActiveSheet.PivotTables( _
        "tablaDinamica1").PivotFields("BETRG"), "Cuenta de BETRG", xlCount
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Cuenta de BETRG")
        .Caption = "Suma de BETRG"
        .Function = xlSum
    End With
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERSONID").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("FORML").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("INDX1").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KOSTL").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("STEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LGART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BETRG").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").RowAxisLayout xlTabularRow
    ActiveSheet.PivotTables("tablaDinamica1").RepeatAllLabels xlRepeatLabels

wbauditoria.Save

'Copia y pega los datos en la hoja de valores
lastRow = Sheets("PT X After").Cells(Sheets("PT X After").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("PT X After").Cells(2, Sheets("PT X After").Columns.Count).End(xlToLeft).Column
Sheets("PT X After").Range(Cells(2, 1), Cells(lastRow, lastCol)).Copy
Sheets("PT X After-values").Range("B1").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
wbauditoria.Save

'Texto a numero
Sheets("PT X After-values").Activate
lastRow = Cells(Rows.Count, "B").End(xlUp).row
For i = 2 To lastRow
    If IsNumeric(Range("b" & i).Value) Then
        Range("B" & i).Value = Val(Range("B" & i).Value)
    End If
Next i

'Formula del concatenar el KEY NUMBER
Range("A1").Value = "KEY NUMBER"
lastRow = Cells(Rows.Count, "B").End(xlUp).row
Sheets("PT X After-values").Range("A2:A" & lastRow) = "=+CONCATENATE(RC[1],RC[2])"
Columns("A:AB").AutoFit

'Elimina los numeros de empleado que son 00000000
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "0" Then
            Rows(i).Delete
        End If
Next i

lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "999999" Then
            Rows(i).Delete
        End If
Next i

wbauditoria.Save


'---------------------------------- ABRE ARCHIVO DE Z (BEFORE) ----------------------------------
MsgCase "Please select the Z (BEFORE) database file downloaded from SAP", vbInformation
ruta_Base = Application.GetOpenFilename("Archivos Excel (*.xls; *.xlsx), *.xls; *.xlsx")
Application.AskToUpdateLinks = False

' Verifica si el usuario seleccionó un archivo
If ruta_Base <> "Falso" Then
    'Abre el archivo base
    Set archivoBase = Workbooks.Open(Filename:=ruta_Base, UpdateLinks:=0)
    archivoBase.Activate
    Set hojaOrigen = archivoBase.Sheets(1)

    'Filtra solo los TTA
    Sheets(1).Activate
    lastRow = Cells(Rows.Count, "A").End(xlUp).row
    Rows("1:1").AutoFilter
    Rows("1:1").AutoFilter Field:=14, Criteria1:="=###"
    Range("A1:P" & lastRow).SpecialCells(xlCellTypeVisible).Copy
    wbauditoria.Sheets("Base Z before").Cells(1, 1).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False

    'Guarda el archivo nuevo y cierra el de la base
    wbauditoria.Save
    archivoBase.Close SaveChanges:=False

Else
End If



'Codigo para que cambie lo de las B
Sheets("Base Z before").Activate
Columns("M:M").Insert Shift:=xlToRight
Range("M1").Value = "Case"

' Recorrer cada fila desde la 2 hasta la última
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = 2 To lastRow
    texto = Sheets("Base Z before").Cells(i, "L").Value
    Select Case texto
        Case "B01": Sheets("Base Z before").Cells(i, "M").Value = "Case A"
        Case "B02": Sheets("Base Z before").Cells(i, "M").Value = "Case B"
        Case "B02S": Sheets("Base Z before").Cells(i, "M").Value = "Case Bs"
        Case "B03": Sheets("Base Z before").Cells(i, "M").Value = "Case C"
        Case "B04": Sheets("Base Z before").Cells(i, "M").Value = "Case D"
        Case "B05": Sheets("Base Z before").Cells(i, "M").Value = "Case E"
        Case "B06": Sheets("Base Z before").Cells(i, "M").Value = "Case F"
        Case "B07": Sheets("Base Z before").Cells(i, "M").Value = "Case G"
        Case "B22": Sheets("Base Z before").Cells(i, "M").Value = "Case H"
        Case "B23": Sheets("Base Z before").Cells(i, "M").Value = "Case I"
        Case "B10": Sheets("Base Z before").Cells(i, "M").Value = "Case J"
        Case "B11": Sheets("Base Z before").Cells(i, "M").Value = "Case K"
        Case "B12": Sheets("Base Z before").Cells(i, "M").Value = "Case L"
        Case "B13": Sheets("Base Z before").Cells(i, "M").Value = "Case M"
        Case "B14": Sheets("Base Z before").Cells(i, "M").Value = "Case N"
        Case "B15": Sheets("Base Z before").Cells(i, "M").Value = "Case O"
        Case "B16": Sheets("Base Z before").Cells(i, "M").Value = "Case P"
        Case "B17": Sheets("Base Z before").Cells(i, "M").Value = "Case Q"
        Case "B18": Sheets("Base Z before").Cells(i, "M").Value = "Case R"
        Case "B19": Sheets("Base Z before").Cells(i, "M").Value = "Case S"
        Case "B20": Sheets("Base Z before").Cells(i, "M").Value = "Case T"
        Case "B21": Sheets("Base Z before").Cells(i, "M").Value = "Case U"
        Case "B08": Sheets("Base Z before").Cells(i, "M").Value = "Case V"
        Case "B09": Sheets("Base Z before").Cells(i, "M").Value = "Case W"
        Case Else: Sheets("Base Z before").Cells(i, "M").Value = texto ' Mantener el mismo valor
    End Select
Next i

'Poner todos los boxes para que el rango no cambie
lastRow = Sheets("Base Z before").Cells(Sheets("Base Z before").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("Base Z before").Cells(2, Sheets("Base Z before").Columns.Count).End(xlToLeft).Column

ThisWorkbook.Sheets("Anexxes").Range("G2:G23").Copy
wbauditoria.Sheets("Base Z before").Cells(lastRow + 1, "M").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
ThisWorkbook.Sheets("Anexxes").Range("I2:I23").Copy
wbauditoria.Sheets("Base Z before").Cells(lastRow + 1, "A").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False

'Crea tabla dinamica
Sheets("Base Z before").Activate

    ult_Tabla = Cells(Rows.Count, "A").End(xlUp).row
    Set rangoTabla1 = Sheets("Base Z before").Range("A1:Q" & ult_Tabla)
    ActiveSheet.ListObjects.Add(xlSrcRange, rangoTabla1, , xlYes).Name = "Tabla1"
    
    'Crear tabla dinamica
    Set celdaTablaDinamica1 = Sheets("PT Z Before").Range("A1")
    
    'Activa campos y le pone formato tabular
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        rangoTabla1, Version:=6).CreatePivotTable TableDestination:= _
        celdaTablaDinamica1, TableName:="tablaDinamica1", DefaultVersion:=6
        
    Sheets("PT Z Before").Select
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR")
        .Orientation = xlRowField
        .Position = 1
    End With
    ActiveWindow.SmallScroll Down:=6
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN")
        .Orientation = xlRowField
        .Position = 3
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA")
        .Orientation = xlRowField
        .Position = 4
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR")
        .Orientation = xlRowField
        .Position = 5
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Case")
        .Orientation = xlColumnField
        .Position = 1
    End With
    ActiveSheet.PivotTables("tablaDinamica1").AddDataField ActiveSheet.PivotTables( _
        "tablaDinamica1").PivotFields("BETRG"), "Cuenta de BETRG", xlCount
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Cuenta de BETRG")
        .Caption = "Suma de BETRG"
        .Function = xlSum
    End With
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERSONID").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("FORML").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("INDX1").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KOSTL").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Case").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("STEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LGART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BETRG").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").RowAxisLayout xlTabularRow
    ActiveSheet.PivotTables("tablaDinamica1").RepeatAllLabels xlRepeatLabels
    

wbauditoria.Save

'Copia y pega los datos en la hoja de valores
lastRow = Sheets("PT Z Before").Cells(Sheets("PT Z Before").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("PT Z Before").Cells(2, Sheets("PT Z Before").Columns.Count).End(xlToLeft).Column
Sheets("PT Z Before").Range(Cells(2, 1), Cells(lastRow, lastCol)).Copy
Sheets("PT Z Before-values").Range("B1").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
wbauditoria.Save

'Texto a numero
Sheets("PT Z Before-values").Activate
lastRow = Cells(Rows.Count, "B").End(xlUp).row
For i = 2 To lastRow
    If IsNumeric(Range("b" & i).Value) Then
        Range("B" & i).Value = Val(Range("B" & i).Value)
    End If
Next i

'Formula del concatenar el KEY NUMBER
Range("A1").Value = "KEY NUMBER"
lastRow = Cells(Rows.Count, "B").End(xlUp).row
Sheets("PT Z Before-values").Range("A2:A" & lastRow) = "=+CONCATENATE(RC[1],RC[2])"
Columns("A:AC").AutoFit

'Elimina los numeros de empleado que son 00000000
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "0" Then
            Rows(i).Delete
        End If
Next i

lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "999999" Then
            Rows(i).Delete
        End If
Next i

wbauditoria.Save


'---------------------------------- ABRE ARCHIVO DE Z (AFTER) ----------------------------------
MsgCase "Please select the Z (AFTER) database file downloaded from SAP", vbInformation
ruta_Base = Application.GetOpenFilename("Archivos Excel (*.xls; *.xlsx), *.xls; *.xlsx")
Application.AskToUpdateLinks = False

' Verifica si el usuario seleccionó un archivo
If ruta_Base <> "Falso" Then
    'Abre el archivo base
    Set archivoBase = Workbooks.Open(Filename:=ruta_Base, UpdateLinks:=0)
    archivoBase.Activate
    Set hojaOrigen = archivoBase.Sheets(1)

    'Filtra solo los TTA
    Sheets(1).Activate
    lastRow = Cells(Rows.Count, "A").End(xlUp).row
    Rows("1:1").AutoFilter
    Rows("1:1").AutoFilter Field:=14, Criteria1:="=###"
    Range("A1:P" & lastRow).SpecialCells(xlCellTypeVisible).Copy
    wbauditoria.Sheets("Base Z After").Cells(1, 1).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False

    'Guarda el archivo nuevo y cierra el de la base
    wbauditoria.Save
    archivoBase.Close SaveChanges:=False

Else
End If

'Codigo para que cambie lo de las B
Sheets("Base Z After").Activate
Columns("M:M").Insert Shift:=xlToRight
Range("M1").Value = "Case"

' Recorrer cada fila desde la 2 hasta la última
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = 2 To lastRow
    texto = Sheets("Base Z After").Cells(i, "L").Value
    Select Case texto
        Case "B01": Sheets("Base Z After").Cells(i, "M").Value = "Case A"
        Case "B02": Sheets("Base Z After").Cells(i, "M").Value = "Case B"
        Case "B02S": Sheets("Base Z After").Cells(i, "M").Value = "Case Bs"
        Case "B03": Sheets("Base Z After").Cells(i, "M").Value = "Case C"
        Case "B04": Sheets("Base Z After").Cells(i, "M").Value = "Case D"
        Case "B05": Sheets("Base Z After").Cells(i, "M").Value = "Case E"
        Case "B06": Sheets("Base Z After").Cells(i, "M").Value = "Case F"
        Case "B07": Sheets("Base Z After").Cells(i, "M").Value = "Case G"
        Case "B22": Sheets("Base Z After").Cells(i, "M").Value = "Case H"
        Case "B23": Sheets("Base Z After").Cells(i, "M").Value = "Case I"
        Case "B10": Sheets("Base Z After").Cells(i, "M").Value = "Case J"
        Case "B11": Sheets("Base Z After").Cells(i, "M").Value = "Case K"
        Case "B12": Sheets("Base Z After").Cells(i, "M").Value = "Case L"
        Case "B13": Sheets("Base Z After").Cells(i, "M").Value = "Case M"
        Case "B14": Sheets("Base Z After").Cells(i, "M").Value = "Case N"
        Case "B15": Sheets("Base Z After").Cells(i, "M").Value = "Case O"
        Case "B16": Sheets("Base Z After").Cells(i, "M").Value = "Case P"
        Case "B17": Sheets("Base Z After").Cells(i, "M").Value = "Case Q"
        Case "B18": Sheets("Base Z After").Cells(i, "M").Value = "Case R"
        Case "B19": Sheets("Base Z After").Cells(i, "M").Value = "Case S"
        Case "B20": Sheets("Base Z After").Cells(i, "M").Value = "Case T"
        Case "B21": Sheets("Base Z After").Cells(i, "M").Value = "Case U"
        Case "B08": Sheets("Base Z After").Cells(i, "M").Value = "Case V"
        Case "B09": Sheets("Base Z After").Cells(i, "M").Value = "Case W"
        Case Else: Sheets("Base Z After").Cells(i, "M").Value = texto ' Mantener el mismo valor
    End Select
Next i

'Poner todos los boxes para que el rango no cambie
lastRow = Sheets("Base Z After").Cells(Sheets("Base Z After").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("Base Z After").Cells(2, Sheets("Base Z After").Columns.Count).End(xlToLeft).Column

ThisWorkbook.Sheets("Anexxes").Range("G2:G23").Copy
wbauditoria.Sheets("Base Z After").Cells(lastRow + 1, "M").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
ThisWorkbook.Sheets("Anexxes").Range("I2:I23").Copy
wbauditoria.Sheets("Base Z After").Cells(lastRow + 1, "A").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False

'Crea tabla dinamica
Sheets("Base Z After").Activate

    ult_Tabla = Cells(Rows.Count, "A").End(xlUp).row
    Set rangoTabla1 = Sheets("Base Z After").Range("A1:Q" & ult_Tabla)
    ActiveSheet.ListObjects.Add(xlSrcRange, rangoTabla1, , xlYes).Name = "Tabla1"
    
    'Crear tabla dinamica
    Set celdaTablaDinamica1 = Sheets("PT Z After").Range("A1")
    
    'Activa campos y le pone formato tabular
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        rangoTabla1, Version:=6).CreatePivotTable TableDestination:= _
        celdaTablaDinamica1, TableName:="tablaDinamica1", DefaultVersion:=6
        
    Sheets("PT Z After").Select
   With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR")
        .Orientation = xlRowField
        .Position = 1
    End With
    ActiveWindow.SmallScroll Down:=6
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN")
        .Orientation = xlRowField
        .Position = 3
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA")
        .Orientation = xlRowField
        .Position = 4
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR")
        .Orientation = xlRowField
        .Position = 5
    End With
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Case")
        .Orientation = xlColumnField
        .Position = 1
    End With
    ActiveSheet.PivotTables("tablaDinamica1").AddDataField ActiveSheet.PivotTables( _
        "tablaDinamica1").PivotFields("BETRG"), "Cuenta de BETRG", xlCount
    With ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Cuenta de BETRG")
        .Caption = "Suma de BETRG"
        .Function = xlSum
    End With
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERNR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("PERSONID").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("FORML").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("INDX1").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BUSNM").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WRKAR").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("WTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KOSTL").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("KTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("NACHN").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("VORNA").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("SLART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("Case").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("STEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LGART").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("LTEXT").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").PivotFields("BETRG").Subtotals = _
        Array(False, False, False, False, False, False, False, False, False, False, False, False)
    ActiveSheet.PivotTables("tablaDinamica1").RowAxisLayout xlTabularRow
    ActiveSheet.PivotTables("tablaDinamica1").RepeatAllLabels xlRepeatLabels
    

wbauditoria.Save

'Copia y pega los datos en la hoja de valores
lastRow = Sheets("PT Z After").Cells(Sheets("PT Z After").Rows.Count, 1).End(xlUp).row
lastCol = Sheets("PT Z After").Cells(2, Sheets("PT Z After").Columns.Count).End(xlToLeft).Column
Sheets("PT Z After").Range(Cells(2, 1), Cells(lastRow, lastCol)).Copy
Sheets("PT Z After-values").Range("B1").PasteSpecial Paste:=xlPasteValues
Application.CutCopyMode = False
wbauditoria.Save

'Texto a numero
Sheets("PT Z After-values").Activate
lastRow = Cells(Rows.Count, "B").End(xlUp).row
For i = 2 To lastRow
    If IsNumeric(Range("b" & i).Value) Then
        Range("B" & i).Value = Val(Range("B" & i).Value)
    End If
Next i

'Formula del concatenar el KEY NUMBER
Range("A1").Value = "KEY NUMBER"
lastRow = Cells(Rows.Count, "B").End(xlUp).row
Sheets("PT Z After-values").Range("A2:A" & lastRow) = "=+CONCATENATE(RC[1],RC[2])"
Columns("A:AC").AutoFit

'Elimina los numeros de empleado que son 00000000
lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "0" Then
            Rows(i).Delete
        End If
Next i

lastRow = Cells(Rows.Count, "A").End(xlUp).row
For i = lastRow To 2 Step -1
        If Cells(i, "B").Value = "999999" Then
            Rows(i).Delete
        End If
Next i

'Oculta hojas que ya no son necesarias
wbauditoria.Sheets("Base X before").Visible = xlSheetHidden
wbauditoria.Sheets("Base X After").Visible = xlSheetHidden
wbauditoria.Sheets("Base Z before").Visible = xlSheetHidden
wbauditoria.Sheets("Base Z After").Visible = xlSheetHidden
wbauditoria.Save

'---------------------------------- ELIMINAR LAS COLUMNAS QUE NO SON NECESARIAS ----------------------------------
'La eliminacion depende de cual auditoria se esta ejecutando, solo va a dejar las que necesita

'Hoja PT X Before-values
Sheets("PT X Before-values").Activate
Select Case auditoria
 
     Case "Health Tax"
        Union(Columns("G:I"), Columns("L:P"), Columns("R:AF")).Delete
         
     Case "Taxable"
        Union(Columns("L:P"), Columns("T:Y"), Columns("Z:AF")).Delete
         
     Case "Taxable B"
        Union(Columns("L:P"), Columns("T:Z"), Columns("AB:AF")).Delete
         
     Case "Pension"
        Union(Columns("G:U"), Columns("W:AF")).Delete
        
     Case "Cases"
        Union(Columns("G:G"), Columns("L:P"), Columns("T:AF")).Delete
         
     Case "EI boxes validation"
        Union(Columns("G:I"), Columns("K:K"), Columns("N:O"), Columns("Q:AF")).Delete
         
 End Select

'PT X After-values
Sheets("PT X After-values").Activate
Select Case auditoria
 
     Case "Health Tax"
        Union(Columns("G:I"), Columns("L:P"), Columns("R:AF")).Delete
         
     Case "Taxable"
        Union(Columns("L:P"), Columns("T:Y"), Columns("Z:AF")).Delete
         
     Case "Taxable B"
        Union(Columns("L:P"), Columns("T:Z"), Columns("AB:AF")).Delete
         
     Case "Pension"
        Union(Columns("G:U"), Columns("W:AF")).Delete
        
     Case "Cases"
        Union(Columns("G:G"), Columns("L:P"), Columns("T:AF")).Delete
         
     Case "EI boxes validation"
        Union(Columns("G:I"), Columns("K:K"), Columns("N:O"), Columns("Q:AF")).Delete
         
 End Select
 
'Hoja PT Z Before-values
Sheets("PT Z Before-values").Activate
Select Case auditoria
 
     Case "Health Tax"
        Union(Columns("K:N"), Columns("P:Q"), Columns("S:AC")).Delete
         
     Case "Taxable"
        Union(Columns("K:N"), Columns("P:U"), Columns("W:AC")).Delete
         
     Case "Taxable B"
        Union(Columns("K:N"), Columns("P:R"), Columns("T:AC")).Delete
         
     Case "Pension"
        Application.DisplayAlerts = False
        Sheets(1).Activate
        wbauditoria.Sheets("Base Z before").Delete
        wbauditoria.Sheets("PT Z Before").Delete
        wbauditoria.Sheets("PT Z Before-values").Delete
        wbauditoria.Sheets("Validation Z").Delete
        Application.DisplayAlerts = True
        
     Case "Cases"
        Union(Columns("G:G"), Columns("K:N"), Columns("P:R"), Columns("T:X"), Columns("AB:AC")).Delete
         
     Case "EI boxes validation"
        Union(Columns("G:J"), Columns("L:AC")).Delete
         
 End Select
 
'Hoja PT Z After-values
Sheets("PT Z After-values").Activate
Select Case auditoria
 
     Case "Health Tax"
        Union(Columns("K:N"), Columns("P:Q"), Columns("S:AC")).Delete
         
     Case "Taxable"
        Union(Columns("K:N"), Columns("P:U"), Columns("W:AC")).Delete
         
     Case "Taxable B"
        Union(Columns("K:N"), Columns("P:R"), Columns("T:AC")).Delete
         
     Case "Pension"
        Application.DisplayAlerts = False
        Sheets(1).Activate
        wbauditoria.Sheets("Base Z After").Delete
        wbauditoria.Sheets("PT Z After").Delete
        wbauditoria.Sheets("PT Z After-values").Delete
        Application.DisplayAlerts = True
        
     Case "Cases"
        Union(Columns("G:G"), Columns("K:N"), Columns("P:R"), Columns("T:X"), Columns("AB:AC")).Delete
         
     Case "EI boxes validation"
        Union(Columns("G:J"), Columns("L:AC")).Delete
         
 End Select
 wbauditoria.Save


'---------------------------------- CREA PLANTILLA DE LAS HOJAS DE LAS VALIDACIONES ----------------------------------
'Va a cada modulo y crea la auditoria

Select Case auditoria
 
     Case "Health Tax"
        Call HT_Entry
       
     Case "Taxable"
        Call Auto_TB_Entries
         
     Case "Taxable B"
        Call Taxable_B_Entries
         
     Case "Pension"
        Call Pension_Entries
        
     Case "Cases"
        CallCases_validation
         
     Case "EI boxes validation"
        Call EI_boxes_validation
         
 End Select


End Sub

Sub HT_Entry()

     '------ Crea la hoja de validacion del Z
        
        'Copia los datos de la hoja de before del Z
        Sheets("Validation Z").Activate
        lastRow = Sheets("PT Z Before-values").Cells(Sheets("PT Z Before-values").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("PT Z Before-values").Cells(1, Sheets("PT Z Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT Z Before-values").Range(wbauditoria.Sheets("PT Z Before-values").Cells(1, 1), wbauditoria.Sheets("PT Z Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation Z").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value
        
        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        
        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L2:AS2").Copy
        wbauditoria.Sheets("Validation Z").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AS").AutoFit
        
        'Coloca titulos en celdas combinadas
        Range("H1:M1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("N1:S1").Merge
        Range("N1").Value = "AFTER ENTRIES"
        Range("T1:Y1").Merge
        Range("T1").Value = "DIFFERENCES"
        Range("AA1:AH1").Merge
        Range("AA1").Value = "VALIDATION"
        
        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("H1:M2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("N1:S2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("T1:Y2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("Z1:Z2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("AA1:AH2")
            .Font.Bold = True
            .Interior.Color = RGB(232, 218, 239)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        Columns("A:AH").AutoFit
        
        'Formula de la columa A
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        Sheets("Validation Z").Range("A3:A" & lastRow) = "=COUNTIF('PT Z After-values'!C[1],'Validation Z'!RC[2])"
        
        'Coloca el resto de las formulas
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        Sheets("Validation Z").Range("N3:N" & lastRow) = "=VLOOKUP(RC[-12],'PT Z After-values'!C1:C12,7,0)"
        Sheets("Validation Z").Range("O3:O" & lastRow) = "=VLOOKUP(RC[-13],'PT Z After-values'!C1:C12,8,0)"
        Sheets("Validation Z").Range("P3:P" & lastRow) = "=VLOOKUP(RC[-14],'PT Z After-values'!C1:C12,9,0)"
        Sheets("Validation Z").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-15],'PT Z After-values'!C1:C12,10,0)"
        Sheets("Validation Z").Range("R3:R" & lastRow) = "=VLOOKUP(RC[-16],'PT Z After-values'!C1:C12,11,0)"
        Sheets("Validation Z").Range("S3:S" & lastRow) = "=VLOOKUP(RC[-17],'PT Z After-values'!C1:C12,12,0)"
        Sheets("Validation Z").Range("T3:T" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("U3:U" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("V3:V" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("W3:W" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("X3:X" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("Y3:Y" & lastRow) = "=RC[-6]-RC[-12]"
        Sheets("Validation Z").Range("Z3:Z" & lastRow) = "=VLOOKUP(RC[-23],'CaseJ entry'!C1:C4,4,0)"
        Sheets("Validation Z").Range("AA3:AA" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-1]),2)"
        Sheets("Validation Z").Range("AB3:AB" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-2]),2)"
        Sheets("Validation Z").Range("AC3:AC" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-3]),2)"
        Sheets("Validation Z").Range("AD3:AD" & lastRow) = "=IF((RC[-9]+RC[-8])=RC[-7],0,RC[-7])"
        Sheets("Validation Z").Range("AE3:AE" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-5]),2)"
        Sheets("Validation Z").Range("AF3:AF" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-6]),2)"
        Sheets("Validation Z").Range("AG3:AG" & lastRow) = "=VLOOKUP(RC[-30],'CaseJ entry'!C1:C2,2,0)"
        Sheets("Validation Z").Range("AH3:AH" & lastRow) = "=RC[-1]-RC[-15]"
        Columns("A:AH").AutoFit

        
        '------ Crea la hoja de validacion del X
        
        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value
        
        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        
        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L1:AL1").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AC").AutoFit
        
        'Coloca titulos en celdas combinadas
        Range("H1:J1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("K1:M1").Merge
        Range("K1").Value = "AFTER ENTRIES"
        Range("N1:P1").Merge
        Range("N1").Value = "DIFFERENCES"
        Range("R1:T1").Merge
        Range("R1").Value = "VALIDATION"
        Range("U1:AA1").Merge
        Range("U1").Value = "Z VALIDATION"
        
        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("H1:J2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("K1:M2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("N1:P2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("Q1:Q2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("R1:T2")
            .Font.Bold = True
            .Interior.Color = RGB(232, 218, 239)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        
        With Range("U1:AA2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With
        Columns("A:AC").AutoFit
        
        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
        
        'Coloca el resto de las formulas
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
        Columns("A:AC").AutoFit
        
        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation Z").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Move After:=Sheets("Validation Z")
        Sheets("Validation Z").Tab.Color = RGB(250, 219, 216)
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)
        
        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit
        
        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub

Sub Auto_TB_Entries()

'------ Crea la hoja de validacion del Z
        
        'Copia los datos de la hoja de before del Z
        Sheets("Validation Z").Activate
        lastRow = Sheets("PT Z Before-values").Cells(Sheets("PT Z Before-values").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("PT Z Before-values").Cells(1, Sheets("PT Z Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT Z Before-values").Range(wbauditoria.Sheets("PT Z Before-values").Cells(1, 1), wbauditoria.Sheets("PT Z Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation Z").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L4:AQ4").Copy
        wbauditoria.Sheets("Validation Z").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AQ").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:M1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("N1:S1").Merge
        Range("N1").Value = "AFTER ENTRIES"
        Range("T1:Y1").Merge
        Range("T1").Value = "DIFFERENCES"
'        Range("AA1:AF1").Merge
'        Range("AA1").Value = "VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:M2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("N1:S2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("T1:Y2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("Z1:Z2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("AA1:AH2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        Columns("A:AH").AutoFit
'
        'Formula de la columa A
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        Sheets("Validation Z").Range("A3:A" & lastRow) = "=COUNTIF('PT Z After-values'!C[1],'Validation Z'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation Z").Range("N3:N" & lastRow) = "=VLOOKUP(RC[-12],'PT Z After-values'!C1:C12,7,0)"
'        Sheets("Validation Z").Range("O3:O" & lastRow) = "=VLOOKUP(RC[-13],'PT Z After-values'!C1:C12,8,0)"
'        Sheets("Validation Z").Range("P3:P" & lastRow) = "=VLOOKUP(RC[-14],'PT Z After-values'!C1:C12,9,0)"
'        Sheets("Validation Z").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-15],'PT Z After-values'!C1:C12,10,0)"
'        Sheets("Validation Z").Range("R3:R" & lastRow) = "=VLOOKUP(RC[-16],'PT Z After-values'!C1:C12,11,0)"
'        Sheets("Validation Z").Range("S3:S" & lastRow) = "=VLOOKUP(RC[-17],'PT Z After-values'!C1:C12,12,0)"
'        Sheets("Validation Z").Range("T3:T" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("U3:U" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("V3:V" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("W3:W" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("X3:X" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Y3:Y" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Z3:Z" & lastRow) = "=VLOOKUP(RC[-23],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation Z").Range("AA3:AA" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-1]),2)"
'        Sheets("Validation Z").Range("AB3:AB" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-2]),2)"
'        Sheets("Validation Z").Range("AC3:AC" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-3]),2)"
'        Sheets("Validation Z").Range("AD3:AD" & lastRow) = "=IF((RC[-9]+RC[-8])=RC[-7],0,RC[-7])"
'        Sheets("Validation Z").Range("AE3:AE" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-5]),2)"
'        Sheets("Validation Z").Range("AF3:AF" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-6]),2)"
'        Sheets("Validation Z").Range("AG3:AG" & lastRow) = "=VLOOKUP(RC[-30],'CaseJ entry'!C1:C2,2,0)"
'        Sheets("Validation Z").Range("AH3:AH" & lastRow) = "=RC[-1]-RC[-15]"
'        Columns("A:AH").AutoFit


        '------ Crea la hoja de validacion del X

        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L3:AU3").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AU").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:N1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("O1:U1").Merge
        Range("O1").Value = "AFTER ENTRIES"
        Range("V1:AB1").Merge
        Range("V1").Value = "DIFFERENCES"
        Range("R1:T1").Merge
'        Range("R1").Value = "VALIDATION"
'        Range("U1:AA1").Merge
'        Range("U1").Value = "Z VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:N2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("O1:U2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("V1:AB2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("AC1:AC2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("R1:T2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        With Range("U1:AA2")
'            .Font.Bold = True
'            .Interior.Color = RGB(250, 229, 211)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
        Columns("A:AC").AutoFit

        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
'        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
'        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
'        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
'        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
'        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
'        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
'        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
'        Columns("A:AC").AutoFit

        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation Z").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Move After:=Sheets("Validation Z")
        Sheets("Validation Z").Tab.Color = RGB(250, 219, 216)
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)

        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit

        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub

Sub Taxable_B_Entries()

'------ Crea la hoja de validacion del Z
        
        'Copia los datos de la hoja de before del Z
        Sheets("Validation Z").Activate
        lastRow = Sheets("PT Z Before-values").Cells(Sheets("PT Z Before-values").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("PT Z Before-values").Cells(1, Sheets("PT Z Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT Z Before-values").Range(wbauditoria.Sheets("PT Z Before-values").Cells(1, 1), wbauditoria.Sheets("PT Z Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation Z").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L6:AK6").Copy
        wbauditoria.Sheets("Validation Z").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AQ").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:M1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("N1:S1").Merge
        Range("N1").Value = "AFTER ENTRIES"
        Range("T1:Y1").Merge
        Range("T1").Value = "DIFFERENCES"
'        Range("AA1:AF1").Merge
'        Range("AA1").Value = "VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:M2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("N1:S2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("T1:Y2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("Z1:Z2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("AA1:AH2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        Columns("A:AH").AutoFit
'
        'Formula de la columa A
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        Sheets("Validation Z").Range("A3:A" & lastRow) = "=COUNTIF('PT Z After-values'!C[1],'Validation Z'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation Z").Range("N3:N" & lastRow) = "=VLOOKUP(RC[-12],'PT Z After-values'!C1:C12,7,0)"
'        Sheets("Validation Z").Range("O3:O" & lastRow) = "=VLOOKUP(RC[-13],'PT Z After-values'!C1:C12,8,0)"
'        Sheets("Validation Z").Range("P3:P" & lastRow) = "=VLOOKUP(RC[-14],'PT Z After-values'!C1:C12,9,0)"
'        Sheets("Validation Z").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-15],'PT Z After-values'!C1:C12,10,0)"
'        Sheets("Validation Z").Range("R3:R" & lastRow) = "=VLOOKUP(RC[-16],'PT Z After-values'!C1:C12,11,0)"
'        Sheets("Validation Z").Range("S3:S" & lastRow) = "=VLOOKUP(RC[-17],'PT Z After-values'!C1:C12,12,0)"
'        Sheets("Validation Z").Range("T3:T" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("U3:U" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("V3:V" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("W3:W" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("X3:X" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Y3:Y" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Z3:Z" & lastRow) = "=VLOOKUP(RC[-23],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation Z").Range("AA3:AA" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-1]),2)"
'        Sheets("Validation Z").Range("AB3:AB" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-2]),2)"
'        Sheets("Validation Z").Range("AC3:AC" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-3]),2)"
'        Sheets("Validation Z").Range("AD3:AD" & lastRow) = "=IF((RC[-9]+RC[-8])=RC[-7],0,RC[-7])"
'        Sheets("Validation Z").Range("AE3:AE" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-5]),2)"
'        Sheets("Validation Z").Range("AF3:AF" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-6]),2)"
'        Sheets("Validation Z").Range("AG3:AG" & lastRow) = "=VLOOKUP(RC[-30],'CaseJ entry'!C1:C2,2,0)"
'        Sheets("Validation Z").Range("AH3:AH" & lastRow) = "=RC[-1]-RC[-15]"
'        Columns("A:AH").AutoFit


        '------ Crea la hoja de validacion del X

        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L5:AN5").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AU").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:N1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("O1:U1").Merge
        Range("O1").Value = "AFTER ENTRIES"
        Range("V1:AB1").Merge
        Range("V1").Value = "DIFFERENCES"
        Range("R1:T1").Merge
'        Range("R1").Value = "VALIDATION"
'        Range("U1:AA1").Merge
'        Range("U1").Value = "Z VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:N2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("O1:U2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("V1:AB2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("AC1:AC2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("R1:T2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        With Range("U1:AA2")
'            .Font.Bold = True
'            .Interior.Color = RGB(250, 229, 211)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
        Columns("A:AC").AutoFit

        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
'        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
'        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
'        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
'        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
'        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
'        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
'        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
'        Columns("A:AC").AutoFit

        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation Z").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Move After:=Sheets("Validation Z")
        Sheets("Validation Z").Tab.Color = RGB(250, 219, 216)
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)

        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit

        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub

Sub Pension_Entries()

        '------ Crea la hoja de validacion del X

        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L7:V7").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:K").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1").Value = "BEFORE ENTRIES"
        Range("I1").Value = "AFTER ENTRIES"
        Range("J1").Value = "DIFFERENCES"
'        Range("R1").Value = "VALIDATION"
'        Range("U1:AA1").Merge
'        Range("U1").Value = "Z VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:H2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("I1:I2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("J1:J2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("K1:K2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("R1:T2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        With Range("U1:AA2")
'            .Font.Bold = True
'            .Interior.Color = RGB(250, 229, 211)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
        Columns("A:AC").AutoFit

        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
'        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
'        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
'        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
'        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
'        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
'        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
'        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
'        Columns("A:AC").AutoFit

        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation X").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)

        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit

        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub

Sub Cases_validation()

'------ Crea la hoja de validacion del Z
        
        'Copia los datos de la hoja de before del Z
        Sheets("Validation Z").Activate
        lastRow = Sheets("PT Z Before-values").Cells(Sheets("PT Z Before-values").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("PT Z Before-values").Cells(1, Sheets("PT Z Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT Z Before-values").Range(wbauditoria.Sheets("PT Z Before-values").Cells(1, 1), wbauditoria.Sheets("PT Z Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation Z").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L9:AQ9").Copy
        wbauditoria.Sheets("Validation Z").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AQ").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:O1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("P1:W1").Merge
        Range("P1").Value = "AFTER ENTRIES"
        Range("X1:AE1").Merge
        Range("X1").Value = "DIFFERENCES"
'        Range("AA1:AF1").Merge
'        Range("AA1").Value = "VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:O2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("P1:W2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("X1:AE2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("AF1:AF2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("AA1:AH2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        Columns("A:AH").AutoFit
'
        'Formula de la columa A
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        Sheets("Validation Z").Range("A3:A" & lastRow) = "=COUNTIF('PT Z After-values'!C[1],'Validation Z'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation Z").Range("N3:N" & lastRow) = "=VLOOKUP(RC[-12],'PT Z After-values'!C1:C12,7,0)"
'        Sheets("Validation Z").Range("O3:O" & lastRow) = "=VLOOKUP(RC[-13],'PT Z After-values'!C1:C12,8,0)"
'        Sheets("Validation Z").Range("P3:P" & lastRow) = "=VLOOKUP(RC[-14],'PT Z After-values'!C1:C12,9,0)"
'        Sheets("Validation Z").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-15],'PT Z After-values'!C1:C12,10,0)"
'        Sheets("Validation Z").Range("R3:R" & lastRow) = "=VLOOKUP(RC[-16],'PT Z After-values'!C1:C12,11,0)"
'        Sheets("Validation Z").Range("S3:S" & lastRow) = "=VLOOKUP(RC[-17],'PT Z After-values'!C1:C12,12,0)"
'        Sheets("Validation Z").Range("T3:T" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("U3:U" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("V3:V" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("W3:W" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("X3:X" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Y3:Y" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Z3:Z" & lastRow) = "=VLOOKUP(RC[-23],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation Z").Range("AA3:AA" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-1]),2)"
'        Sheets("Validation Z").Range("AB3:AB" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-2]),2)"
'        Sheets("Validation Z").Range("AC3:AC" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-3]),2)"
'        Sheets("Validation Z").Range("AD3:AD" & lastRow) = "=IF((RC[-9]+RC[-8])=RC[-7],0,RC[-7])"
'        Sheets("Validation Z").Range("AE3:AE" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-5]),2)"
'        Sheets("Validation Z").Range("AF3:AF" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-6]),2)"
'        Sheets("Validation Z").Range("AG3:AG" & lastRow) = "=VLOOKUP(RC[-30],'CaseJ entry'!C1:C2,2,0)"
'        Sheets("Validation Z").Range("AH3:AH" & lastRow) = "=RC[-1]-RC[-15]"
'        Columns("A:AH").AutoFit


        '------ Crea la hoja de validacion del X

        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L8:AH8").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AU").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:L1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("M1:Q1").Merge
        Range("M1").Value = "AFTER ENTRIES"
        Range("R1:V1").Merge
        Range("R1").Value = "DIFFERENCES"
'        Range("R1:T1").Merge
'        Range("R1").Value = "VALIDATION"
'        Range("U1:AA1").Merge
'        Range("U1").Value = "Z VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:L2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("M1:Q2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("R1:V2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("W1:W2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("R1:T2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        With Range("U1:AA2")
'            .Font.Bold = True
'            .Interior.Color = RGB(250, 229, 211)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
        Columns("A:AC").AutoFit

        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
'        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
'        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
'        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
'        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
'        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
'        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
'        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
'        Columns("A:AC").AutoFit

        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation Z").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Move After:=Sheets("Validation Z")
        Sheets("Validation Z").Tab.Color = RGB(250, 219, 216)
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)

        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit

        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub


Sub EI_boxes_validation()

'------ Crea la hoja de validacion del Z
        
        'Copia los datos de la hoja de before del Z
        Sheets("Validation Z").Activate
        lastRow = Sheets("PT Z Before-values").Cells(Sheets("PT Z Before-values").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("PT Z Before-values").Cells(1, Sheets("PT Z Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT Z Before-values").Range(wbauditoria.Sheets("PT Z Before-values").Cells(1, 1), wbauditoria.Sheets("PT Z Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation Z").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L11:V11").Copy
        wbauditoria.Sheets("Validation Z").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AQ").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1").Value = "BEFORE ENTRIES"
        Range("I1").Value = "AFTER ENTRIES"
        Range("J1").Value = "DIFFERENCES"
'        Range("AA1:AF1").Merge
'        Range("AA1").Value = "VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:H2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("I1:I2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("J1:J2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("K1:K2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("AA1:AH2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        Columns("A:AH").AutoFit
'
        'Formula de la columa A
        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation Z").Cells(2, Sheets("Validation Z").Columns.Count).End(xlToLeft).Column
        Sheets("Validation Z").Range("A3:A" & lastRow) = "=COUNTIF('PT Z After-values'!C[1],'Validation Z'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation Z").Cells(Sheets("Validation Z").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation Z").Range("N3:N" & lastRow) = "=VLOOKUP(RC[-12],'PT Z After-values'!C1:C12,7,0)"
'        Sheets("Validation Z").Range("O3:O" & lastRow) = "=VLOOKUP(RC[-13],'PT Z After-values'!C1:C12,8,0)"
'        Sheets("Validation Z").Range("P3:P" & lastRow) = "=VLOOKUP(RC[-14],'PT Z After-values'!C1:C12,9,0)"
'        Sheets("Validation Z").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-15],'PT Z After-values'!C1:C12,10,0)"
'        Sheets("Validation Z").Range("R3:R" & lastRow) = "=VLOOKUP(RC[-16],'PT Z After-values'!C1:C12,11,0)"
'        Sheets("Validation Z").Range("S3:S" & lastRow) = "=VLOOKUP(RC[-17],'PT Z After-values'!C1:C12,12,0)"
'        Sheets("Validation Z").Range("T3:T" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("U3:U" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("V3:V" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("W3:W" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("X3:X" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Y3:Y" & lastRow) = "=RC[-6]-RC[-12]"
'        Sheets("Validation Z").Range("Z3:Z" & lastRow) = "=VLOOKUP(RC[-23],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation Z").Range("AA3:AA" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-1]),2)"
'        Sheets("Validation Z").Range("AB3:AB" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-2]),2)"
'        Sheets("Validation Z").Range("AC3:AC" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-3]),2)"
'        Sheets("Validation Z").Range("AD3:AD" & lastRow) = "=IF((RC[-9]+RC[-8])=RC[-7],0,RC[-7])"
'        Sheets("Validation Z").Range("AE3:AE" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-5]),2)"
'        Sheets("Validation Z").Range("AF3:AF" & lastRow) = "=ROUND(IF(RC[-7]=0,0,RC[-7]-RC[-6]),2)"
'        Sheets("Validation Z").Range("AG3:AG" & lastRow) = "=VLOOKUP(RC[-30],'CaseJ entry'!C1:C2,2,0)"
        Sheets("Validation Z").Range("AH3:AH" & lastRow) = "=RC[-1]-RC[-15]"
        Columns("A:AH").AutoFit


        '------ Crea la hoja de validacion del X

        'Copia los datos de la hoja de before del X
        Sheets("Validation X").Activate
        lastRow = Sheets("PT X Before-values").Cells(Sheets("PT X Before-values").Rows.Count, 1).End(xlUp).row
        lastCol = Sheets("PT X Before-values").Cells(1, Sheets("PT X Before-values").Columns.Count).End(xlToLeft).Column
        Set rng = wbauditoria.Sheets("PT X Before-values").Range(wbauditoria.Sheets("PT X Before-values").Cells(1, 1), wbauditoria.Sheets("PT X Before-values").Cells(lastRow, lastCol))
        wbauditoria.Sheets("Validation X").Range("A2").Resize(rng.Rows.Count, rng.Columns.Count).Value = rng.Value

        'Calcula ultima fila y columna de la hoja de validacion
        Columns("A:A").Insert Shift:=xlToRight
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column

        'Coloca los titulos en la fila 2
        ThisWorkbook.Sheets("Anexxes").Range("L10:AE10").Copy
        wbauditoria.Sheets("Validation X").Range("A2").PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Columns("A:AU").AutoFit

        'Coloca titulos en celdas combinadas
        Range("H1:K1").Merge
        Range("H1").Value = "BEFORE ENTRIES"
        Range("L1:O1").Merge
        Range("L1").Value = "AFTER ENTRIES"
        Range("P1:S1").Merge
        Range("P1").Value = "DIFFERENCES"
'        Range("R1:T1").Merge
'        Range("R1").Value = "VALIDATION"
'        Range("U1:AA1").Merge
'        Range("U1").Value = "Z VALIDATION"

        With Range("A2:G2")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("H1:K2")
            .Font.Bold = True
            .Interior.Color = RGB(209, 242, 235)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("L1:O2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 229, 211)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("P1:S2")
            .Font.Bold = True
            .Interior.Color = RGB(250, 219, 216)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        With Range("T1:T2")
            .Font.Bold = True
            .Interior.Color = RGB(212, 230, 241)
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

'        With Range("R1:T2")
'            .Font.Bold = True
'            .Interior.Color = RGB(232, 218, 239)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
'
'        With Range("U1:AA2")
'            .Font.Bold = True
'            .Interior.Color = RGB(250, 229, 211)
'            .HorizontalAlignment = xlCenter
'            .VerticalAlignment = xlCenter
'        End With
        Columns("A:AC").AutoFit

        'Formula de la columa A
        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
        lastCol = Sheets("Validation X").Cells(2, Sheets("Validation X").Columns.Count).End(xlToLeft).Column
        Sheets("Validation X").Range("A3:A" & lastRow) = "=COUNTIF('PT X After-values'!C[1],'Validation X'!RC[2])"
'
'        'Coloca el resto de las formulas
'        lastRow = Sheets("Validation X").Cells(Sheets("Validation X").Rows.Count, 3).End(xlUp).row
'        Sheets("Validation X").Range("K3:K" & lastRow) = "=VLOOKUP(RC[-9],'PT X After-values'!C1:C9,7,0)"
'        Sheets("Validation X").Range("L3:L" & lastRow) = "=VLOOKUP(RC[-10],'PT X After-values'!C1:C9,8,0)"
'        Sheets("Validation X").Range("M3:M" & lastRow) = "=VLOOKUP(RC[-11],'PT X After-values'!C1:C9,9,0)"
'        Sheets("Validation X").Range("N3:N" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("O3:O" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("P3:P" & lastRow) = "=RC[-3]-RC[-6]"
'        Sheets("Validation X").Range("Q3:Q" & lastRow) = "=VLOOKUP(RC[-14],'CaseJ entry'!C1:C4,4,0)"
'        Sheets("Validation X").Range("R3:R" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("S3:S" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("T3:T" & lastRow) = "=ROUND(IF(RC[-4]=0,0,RC[-4]-RC17),2)"
'        Sheets("Validation X").Range("U3:U" & lastRow) = "=VLOOKUP(RC[-18],'Validation Z'!C[-18]:C[-2],13,0)"
'        Sheets("Validation X").Range("V3:V" & lastRow) = "=VLOOKUP(RC[-19],'Validation Z'!C3:C19,14,0)"
'        Sheets("Validation X").Range("W3:W" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("X3:X" & lastRow) = "=RC[-2]-RC[-12]"
'        Sheets("Validation X").Range("Y3:Y" & lastRow) = "=VLOOKUP(RC[-22],'Validation Z'!C3:C19,15,0)"
'        Sheets("Validation X").Range("Z3:Z" & lastRow) = "=(RC[-5]+RC[-4])-RC[-1]"
'        Sheets("Validation X").Range("AA3:AA" & lastRow) = "=RC[-2]-RC[-6]"
'        Columns("A:AC").AutoFit

        'Ordena hojas
        Sheets("CaseJ entry").Move Before:=Sheets(1)
        Sheets("Validation Z").Move After:=Sheets("CaseJ entry")
        Sheets("Validation X").Move After:=Sheets("Validation Z")
        Sheets("Validation Z").Tab.Color = RGB(250, 219, 216)
        Sheets("Validation X").Tab.Color = RGB(250, 229, 211)

        'Organiza la hoja de CaseJ entry
        Sheets("CaseJ entry").Activate
        Range("A1").Value = "SAP ID"
        Range("B1").Value = "CORRECT BOX J"
        Range("C1").Value = "BOX J TOTAL"
        Range("D1").Value = "SAP DIFFRENCE (ENTRY)"
         With Range("A1:D1")
            .Font.Bold = True
            .HorizontalAlignment = xlCenter
            .Interior.Color = RGB(235, 237, 239)
        End With
        Columns("A:D").AutoFit

        'Finaliza
        wbauditoria.Save
        wbauditoria.Close
        MsgCase "The process has been completed. Please enter the document and complete the data in the 'CaseJ entry' sheet.", vbInformation

End Sub
